<header>
  <span>Group Invoicing</span>
</header>

<section class="top-nav">
<!-- split button -->
  <!--
  <div class="btn-group">
    <button class="btn btn btn-primary" ng-class="{active : !!invoice.convention_id }">{{conventions.get(invoice.convention_id).name || "Choose Convention"}}</button>
    <button class="btn btn-sm btn-primary dropdown-toggle"><i class="glyphicon glyphicon-chevron-down"></i></button>
    <ul class="dropdown-menu">
      <li ng-repeat="convention in conventions.data">
        <a ng-click="setConvention(convention)" href="">{{convention.name}}</a>
      </li>
    </ul>
  </div>
  -->

  <span class="btn btn-sm btn-default" ng-show="!!selected.convention">{{ selected.convention.name }}</span>

</section>

<div class="content">

  <div class="col-xs-6" ng-switch="hasDebitor">

    <div ng-switch-default>
      <form class="form-horizontal">
        <fieldset>
          <legend>Select Payment Details</legend>

          <div class="form-group">
            <label class="control-label col-xs-2">Convention : </label>
            <div class="col-xs-8">
              <select class="form-kapok" ng-model="selected.convention" ng-options="group as group.name for group in conventions.data">
                <option value="">-- Select a Convention --</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="control-label col-xs-2">Debitor:</label>
            <div class="col-xs-8">
              <select class="form-kapok" ng-model="selected.debitor" ng-options="debitor as debitor.text for debitor in debitors.data">
                <option value="">-- Select a Debitor --</option>
              </select>
            </div>
          </div>

          <input class="btn btn-sm btn-success" type="submit" ng-click="setDebitor()" value="Continue" ng-disabled="!selected.debitor || !selected.convention">

        </fieldset>
      </form>
    </div>
    <div class="panel panel-default" ng-switch-when="true">
      <div class="panel-heading">
        <i class="glyphicon glyphicon-list"></i>
        <span> Select Invoices</span>
			</div>
      <table class="table table-condensed">
        <thead>
          <tr><th>Invoice ID</th><th>Debitor ID</th><th>Date</th><th>Total</th><th colspan="2" style="width:10%;">Actions</th></tr>
        </thead>
        <tbody>
          <tr ng-repeat="invoice in invoices.data | filter:filter">
            <td>{{invoice.inv_po_id}}</td>
            <td>{{invoice.deb_cred_id}}</td>
            <td>{{invoice.trans_date | date}}</td>
            <td>{{invoice.balance | currency }}</td>
            <td><button class="btn btn-sm btn-default" ng-click="examineInvoice(invoice, $index)"><i class="glyphicon glyphicon-search"></i></button></td>
            <td><button class="btn btn-sm btn-default" ng-click="enqueue($index)"><i class="glyphicon glyphicon-plus"></i></button></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="col-xs-6" ng-switch="action">

    <div ng-switch-when="info">
      <div class="alert alert-info">
        <h4>Group Invoicing</h4>
        <p> Choose a convention from the upper left hand corner of the screen. </p>
      </div>
    </div>

    <div ng-switch-when="pay">
      <div class="panel panel-default">
        <div class="panel-heading">
          <span>Convention Invoice</span>
        </div>
        <div class="panel-body">
          <form name="payment" class="form-horizontal">
            <fieldset>
              <legend>Convention Invoice for Debitor {{ selected.debitor.text }}</legend>

              <div class="form-group" >
                <label class="col-xs-3">Invoice ID</label>
                <label class="col-xs-3">Cost To Debitor</label>
                <label class="">Agreed Payment</label>
              </div>

              <div class="form-group" ng-repeat="invoice in paying">
                <p class="form-control-static col-xs-3">{{ invoice.inv_po_id }}</p>
                <p class="form-control-static col-xs-3">{{ invoice.balance | currency}}</p>
                <div class="col-xs-6 input-group">
                  <span class="input-group-addon">$</span>
                  <input type="number" class="form-kapok" ng-model="invoice.payment" min="0" max="{{invoice.balance}}">
                </div>
              </div>

            </fieldset>

            <div class="form-group" style="border-top: 1px solid #ddd;">
              <label class="control-label col-xs-2">Balance: </label>
              <p class="col-xs-4 form-control-static">{{ (paymentBalance | currency) || "Check that everything is correctly entered."}}</p>
            </div>
            
          </form>
        </div>
      </div>

      <button class="btn btn-sm btn-success" ng-click="pay()"> Pay Invoices </button>
      <button class="btn btn-sm btn-danger" ng-click="dequeue()"> Cancel </button>
    </div>

    <div ng-switch-when="confirm">
      <div class="panel panel-info">
        <div class="panel-heading">
          Payment Authorization
        </div>
        <div class="panel-body">

          <form name="authorization" class="form-horizontal">
            <fieldset>
              <legend>Convention Invoice for {{ selected.debitor.text }}</legend>

              <div class="form-group" >
                <label class="col-xs-3">Invoice ID</label>
                <label class="col-xs-3">Cost To Debitor</label>
                <label class="">Agreed Payment</label>
              </div>

              <div class="form-group" ng-repeat="invoice in paying">
                <p class="form-control-static col-xs-3">{{ invoice.inv_po_id }}</p>
                <p class="form-control-static col-xs-3">{{ invoice.balance | currency}}</p>
                <p class="form-control-static">{{ invoice.payment | currency }}</p>
              </div>

            </fieldset>

            <div class="form-group">
              <label class="control-label col-xs-2">Balance: </label>
              <p class="col-xs-2 form-control-static">{{ (paymentBalance | currency) || "Check that everything is correctly entered."}}</p>
              <label class="control-label col-xs-2">Authorized By:</label>
              <div class="col-xs-6">
                <input class="form-kapok" ng-model="payment.authorized_by" >
              </div>
            </div>

          </form>
        </div>
      </div>

      <button ng-click="authorize()" class="btn btn-sm btn-success">Authorize</button>
      <button ng-click="cancel()" class="btn btn-sm btn-danger">Cancel</button>
    </div>

    <div ng-switch-when="examine">
      <div class="panel panel-danger">
        <div class="panel-heading">
          <i class="glyphicon glyphicon-list-alt"></i>
          <span> Invoice Details</span>
        </div>
        <div class="panel-body">
          <form class="form-horizontal">
            <fieldset>

              <div class="form-group">
                <label class="control-label col-xs-3">Invoice ID</label>
                <div class="col-xs-9">
                  <p class="form-control-static">{{examine.inv_po_id}}</p>
                </div>
              </div>

              <div class="form-group">
                <label class="control-label col-xs-3">Description</label>
                <div class="col-xs-9">
                  <p class="form-control-static">{{ examine.description }}</p>
                </div>
              </div>

              <div class="form-group">
                <label class="control-label col-xs-3">Invoice Date</label>
                <div class="col-xs-9">
                  <p class="form-control-static">{{examine.trans_date | date}}</p>
                </div>
              </div>
              
              <div class="form-group">
                <label class="control-label col-xs-3">Account ID </label>
                <div class="col-xs-9">
                  <p class="form-control-static">{{examine.account_id }}</p>
                </div>
              </div>

              <div class="form-group">
                <label class="control-label col-xs-3">Debitor</label>
                <div class="col-xs-9">
                  <p class="form-control-static">{{ debitors.get(examine.deb_cred_id).text }}</p>
                </div>
              </div>


              <div class="form-group">
                <label class="control-label col-xs-3"> Balance </label>
                <div class="col-xs-9">
                  <p class="form-control-static">{{examine.balance | currency}}</p>
                </div>
              </div>

              <div class="form-group">
                <label class="control-label col-xs-3">Comment</label>
                <div class="col-xs-9">
                  <p class="form-control-static">{{ examine.comment }}</p>
                </div>
              </div>

            </fieldset>
          </form>
        </div>
      </div>

      <!--
      <button class="btn btn-sm btn-success" ng-click="enqueue()"><i class="glyphicon glyphicon-plus"></i> Add Invoice </button>
      <button class="btn btn-sm btn-default" ng-click="back()"><i class="glyphicon glyphicon-remove"></i> Close </button>
      -->

    </div>
  </div>
</div>
