<header data-header>
  {{ "CASH_PAYMENTS.TITLE" | translate }}
</header>

<section class="top-nav">
  <div class="pull-left">
    <span class="btn-group"> <!-- TODO --->
      <button class="btn btn-sm btn-default" ng-class="{ 'active' : session.active }">{{ (session.selected | translate) || "..." }}</button>
      <button class="btn btn-sm btn-default dropdown-toggle"><span class="caret" data-caret="&#9660;"></span></button>
      <ul class="dropdown-menu">
        <li ng-repeat="opt in options">
          <a href="" ng-click="search(opt)">{{ opt.label | translate }}</a>
        </li>
      </ul>
    </span>
  </div>

  <div>
    <div class="col-xs-3">
      <input class="form-kapok" type="date" ng-model="session.dateFrom" rows="20" ng-change="reset(1)">
    </div>
    <div class="col-xs-3">
      <input class="form-kapok" type="date" ng-model="session.dateTo" rows="20" ng-change="reset(1)">
    </div>
    <div class="col-xs-3 pull-right">
      <select class="form-kapok" ng-model="session.project" ng-change="reset()">
        <option selected value="{{ allProjectIds }}">{{ 'CASH_PAYMENTS.ALL_PROJECTS' | translate }}</option>
        <option ng-repeat="project in projects.data" value="{{ project.id }}">{{ project.name }}</option>
      </select>
    </div>
  </div>

</section>

<div class="report">
  <div class="reportBody">
    <div class="reportFrame">
      <h4>{{ "CASH_PAYMENTS.TITLE" | translate }} <small> {{ state.dateFrom | date }} - {{ state.dateTo | date }}</small></h4>
      <table id="patientTable" class="reportTable">
        <thead>
          <tr>
            <th>{{ "COLUMNS.INVOICE_ID" | translate }}</th>
            <th>{{ "COLUMNS.TYPE" | translate }}</th>
            <th>{{ "COLUMNS.NAME" | translate }}</th>
            <th>{{ "COLUMNS.SALE_ID" | translate }}</th>
            <th>{{ "COLUMNS.DEBITOR_ID" | translate }}</th>
            <th>{{ "COLUMNS.DEBITOR_TYPE" | translate }}</th>
            <th>{{ "COLUMNS.COST" | translate }}</th>
            <th>{{ "COLUMNS.DESCRIPTION" | translate }}</th>
            <th>{{ "COLUMNS.DATE" | translate }}</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat='payment in payments'>
            <td><a ng-href="/#/invoice/cash/{{payment.uuid}}">{{ payment.abbr + payment.reference }}</a></td>
            <td> {{ payment.type }} </td>
            <td> {{ payment.first_name + ' ' + payment.last_name }} </td>
            <td><a ng-href="/#/invoice/sale/{{payment.invoice_uuid}}">{{ projects.get(payment.sale_project).abbr + payment.sale_reference }}</a></td>
            <td> {{ projects.get(payment.debtor_project).abbr + payment.debtor_reference }} </td>
            <td> {{ payment.deb_cred_type }} </td>
            <td ng-bind-html="payment.cost | intlcurrency:payment.currency_id"></td>
            <td> {{ payment.description }} </td>
            <td> {{ payment.date | date }} </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <th colspan="6">{{ "COLUMNS.TOTAL" | translate }} : {{ payments.length }}</th>
            <th colspan="3">{{ sumPayments() | currency }}</th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
