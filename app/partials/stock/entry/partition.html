<header data-header>
  {{ "STOCK.ENTRY.TITLE" | translate }}
</header>

<div class="content">
  <div class="row">

    <form class="col-xs-8">

      <div class="panel square" ng-class="{ 'panel-info' : !!lot.valid, 'panel-danger' : !lot.valid }" ng-repeat="lot in session.lots.data" ng-switch="lot.active">
        <div class="panel-heading">
          <b ng-switch-default> # {{ lot.lot_number }}</b>
          <b ng-switch-when="true">{{ "STOCK.ENTRY.LOT_NUMBER" | translate }}</b>
          <input ng-model="lot.lot_number" class="panel-input" rows="25" ng-switch-when="true">
          <div class="pull-right">
            <a class="action" ng-click="edit(lot)" ng-switch-default><span class="glyphicon glyphicon-pencil"></span></a>
            <a class="action" ng-click="commit(lot)" ng-switch-when="true"><span class="glyphicon glyphicon-ok-circle"></span></a>
            <a class="action" ng-click="remove(lot)" style="padding-left:5px;"><span class="glyphicon glyphicon-remove-circle"></span></a>
          </div>
        </div>
        <div class="panel-body">
          <div class="col-xs-6">
            <div class="form-group">
              <label>{{ "COLUMNS.INVENTORY_CODE" | translate }}</label>
              <p class="form-control-static" ng-switch-default>{{ lot.inventory_code }}</p>
              <select class="form-kapok" ng-model="lot.inventory_code" ng-options="code for code in triage.codes" ng-switch-when="true" ng-change="setQuantity(lot)">
                <option value="" disabled="disabled">-- {{ "SELECT.CODE" | translate }} --</option>
              </select>
            </div>

            <div class="form-group">
              <label>{{ "COLUMNS.QUANTITY" | translate }}</label>
              <p class="form-control-static" ng-switch-default>{{ lot.quantity }}</p>
              <input type="number" class="form-kapok" ng-model="lot.quantity" ng-switch-when="true" min="0">
            </div>
          </div>

          <div class="col-xs-6">
            <div class="form-group">
              <label>{{ "COLUMNS.EXPIRATION_DATE" | translate }}</label>
              <p class="form-control-static" ng-switch-default>{{ lot.expiration_date | date }}</p>
              <input type="date" class="form-kapok" ng-model="lot.expiration_date" ng-switch-when="true">
            </div>

            <div class="form-group">
              <label>{{ "COLUMNS.TRACKING_NUMBER" | translate }}</label>
              <p class="form-control-static" ng-switch-default>{{ lot.tracking_number }}</p>
              <input class="form-kapok" ng-model="lot.tracking_number" ng-switch-when="true">
            </div>
          </div>

        </div>
      </div>

      <div class="btn-group-justified">
        <a class="btn btn-default square" type="button" ng-click="add()"><span class="glyphicon glyphicon-plus"></span></a>
      </div>
    </form>

    <div class="col-xs-4">
      <table class="table table-condensed">
        <thead>
          <tr>
            <th colspan="4">{{ "STOCK.ENTRY.ORDER_DETAILS" | translate }}</th>
          </tr>
          <tr>
            <th>{{ "COLUMNS.CODE" | translate }}</th>
            <th>{{ "COLUMNS.LABEL" | translate }}</th>
            <th>{{ "COLUMNS.QUANTITY" | translate }}</th>
            <th>{{ "STOCK.ENTRY.ASSIGNED" | translate }}</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="drug in session.order.data | orderBy:'code'">
            <td>{{ drug.code }}</td>
            <td>{{ drug.text }}</td>
            <td>{{ drug.quantity }}</td>
            <td>{{ session.totals.inventory[drug.code] || 0 }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<section class="bar-bottom">
  <div class="pull-right">
    <button class="btn btn-sm btn-warning" ng-click="back()">{{ "FORM.BACK" | translate }}</button>
    <button class="btn btn-sm btn-success" ng-click="review()">{{ "FORM.REVIEW" | translate }}</button>
  </div>
</section>
