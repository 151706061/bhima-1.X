<header> 
  <span>{{ "UPDATE_STOCK.TITLE" | translate }}</span>
</header>

<section class="top-nav"></section>

<div class="content">
  <div class="row">
    <div class="col-xs-12">
      <div class="panel" ng-class="{'panel-success' : selectedStock, 'panel-default' : !selectedStock}">
        <div class="panel-heading">
          <span class="glyphicon glyphicon" ng-class="{'glyphicon-search' : session.search, 'glyphicon-list-alt' : !session.search}"></span> 
          <span ng-show="session.search">{{'UPDATE_STOCK.FIND_STOCK' | translate}}</span>
              <span ng-show="!session.search">
                <b>{{selectedStock.code}}</b> 
                {{selectedStock.text}}
              </span>

          <div class="pull-right" ng-hide="session.search">
            <span ng-click="refreshSession()" class="glyphicon glyphicon-refresh"></span>
          </div>
        </div>
        <div class="panel-body" ng-show="session.search">
          <div class="input-group"> 
            <input 
              class="form-kapok" 
              type="text"
              ng-model="session.stockSearch"
              typeahead="stock as stock.text for stock in model.inventory.data | filter: $viewValue | limitTo:10"
              typeahead-on-select="selectStock(session.stockSearch.id)"
              typeahead-template-url="stockItem.html"
              placeholder="{{'UPDATE_STOCK.SEARCH_TEXT' | translate}}">
            <div class="input-group-btn"> 
              <button class="btn btn-default btn-sm" ng-click="loadStock(selectedStock.uuid)" ng-disabled="!selectedStock">{{'FORM.SUBMIT' | translate}}</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-6">
      <div class="panel panel-default">
        <div class="panel-heading">
          <span class="glyphicon glyphicon-list-alt"></span> 
          {{'UPDATE_STOCK.STOCK_HISTORY' | translate}}
        </div>
        
        <!-- ng-show="!session.search" -->  
        <div hidden class="panel-body">
          <table class="table table-bordered table-condensed">
            <thead>
              <tr>
                <td>{{'UPDATE_STOCK.TIMESTAMP' | translate}}</td>
                <td>{{'COLUMNS.PRICE' | translate}}</td>
                <td>{{'COLUMNS.CODE' | translate}}</td>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="record in model.history.data">
                <td>{{record.inventory_log}}</td>
                <td>{{record.price}}</td>
                <td>{{record.code}}</td>
              </tr>
            </tbody>

          </table>
          
        </div>
      </div>
    </div>

    <div class="col-xs-6">
      <div class="panel panel-default">
        <div class="panel-heading">
          <span class="glyphicon glyphicon-pencil"></span> 
          {{'UPDATE_STOCK.TITLE' | translate}}
        </div>

        <div ng-show="!session.search" class="panel-body">
          <div class="form-group">
            <span>{{'LOCATION.CURRENT' | translate}} {{'COLUMNS.PRICE' | translate}}</span>
            <br>
            <span><b>{{cachePrice | currency}}</b></span>
          </div>

          <div class="form-group"> 
            <label>{{'COLUMNS.PRICE' | translate}}</label>
            <input class="form-kapok" ng-model="selectedStock.price">
          </div>

          <div class="form-group">
            <label>{{'COLUMNS.CODE' | translate}}</label>
            <input class="form-kapok" ng-model="selectedStock.code">
          </div>

          <div class="form-group">
            <label>{{'COLUMNS.DESCRIPTION' | translate}}</label>
            <input class="form-kapok" ng-model="selectedStock.text">
          </div>
        </div>

        <div ng-show="!session.search" class="panel-footer">
          <!-- Text should read - Update Stock -->
          <button ng-click="submitUpdate()" class="btn btn-sm btn-success">{{'UPDATE_STOCK.SUBMIT' | translate}}</button>
        </div>
    </div>
  </div>
</div>

<script type="text/ng-template" id="stockItem.html">
  <a>
    <span><b>[{{match.model.code}}]</b></span>
    <span bind-html-unsafe="match.label | typeaheadHighlight:query"></span>
  </a>
</script>
